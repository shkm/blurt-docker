#!/usr/bin/env bash
set -euo pipefail

IMAGE="shkm/blurt"

# Create builder if it doesn't exist
if ! docker buildx inspect multiplatform &>/dev/null; then
    echo "Creating multiplatform builder..."
    docker buildx create --name multiplatform --use
fi

docker buildx use multiplatform

echo "Building and pushing ${IMAGE} for linux/amd64 and linux/arm64..."
docker buildx build \
    --platform linux/amd64,linux/arm64 \
    --tag "${IMAGE}:latest" \
    --push \
    .

echo "Done!"
